---
import { Image } from 'astro:assets';
import { getRelativeLocaleUrl } from 'astro:i18n';
import FormattedDate from './FormattedDate.astro';
import Card from './ui/Card.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
  lang: string;
  variant?: 'featured' | 'regular' | 'related';
  showFeaturedBadge?: boolean;
  featuredText?: string;
}

const {
  post,
  lang,
  variant = 'regular',
  showFeaturedBadge = false,
  featuredText = 'Featured'
} = Astro.props;

const slug = post.id.replace(`${lang}/`, '');

// Variant-specific configurations
const variantConfig = {
  featured: {
    cardVariant: 'elevated' as const,
    cardClass: 'overflow-hidden blog-card',
    containerClass: 'aspect-[16/9] overflow-hidden',
    imageWidth: 600,
    imageHeight: 338,
    contentClass: 'p-8',
    titleClass: 'text-2xl font-bold text-gray-900 dark:text-white mb-3 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors',
    descClass: 'text-gray-600 dark:text-gray-300 mb-6 line-clamp-3',
    categoryClass: 'inline-flex items-center px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded-full',
  },
  regular: {
    cardVariant: 'default' as const,
    cardClass: 'overflow-hidden blog-card h-full flex flex-col',
    containerClass: 'aspect-video overflow-hidden',
    imageWidth: 400,
    imageHeight: 225,
    contentClass: 'p-6 flex-1 flex flex-col',
    titleClass: 'text-xl font-semibold text-gray-900 dark:text-white mb-3 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors line-clamp-2',
    descClass: 'text-gray-600 dark:text-gray-300 mb-4 line-clamp-3 flex-1',
    categoryClass: 'inline-flex items-center px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-full',
  },
  related: {
    cardVariant: 'default' as const,
    cardClass: 'overflow-hidden blog-card h-full flex flex-col',
    containerClass: 'aspect-video overflow-hidden',
    imageWidth: 300,
    imageHeight: 168,
    contentClass: 'p-4 flex-1 flex flex-col',
    titleClass: 'text-lg font-semibold text-gray-900 dark:text-white mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors line-clamp-2',
    descClass: 'text-gray-600 dark:text-gray-300 text-sm mb-3 line-clamp-2 flex-1',
    categoryClass: 'inline-flex items-center px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 rounded-full',
  },
};

const config = variantConfig[variant];
---

<Card
  variant={config.cardVariant}
  hover={true}
  padding="none"
  href={getRelativeLocaleUrl(lang, `blog/${slug}`)}
  class={config.cardClass}
  data-blog-post
  data-title={post.data.title}
  data-description={post.data.description}
  data-category={post.data.category}
>
  {post.data.heroImage && (
    <div class={config.containerClass}>
      <Image
        src={post.data.heroImage.src}
        alt={post.data.heroImage.alt || ''}
        width={config.imageWidth}
        height={config.imageHeight}
        class="blog-card-image w-full h-full object-cover"
      />
    </div>
  )}
  <div class={config.contentClass}>
    <div class={`flex items-center gap-2 ${variant === 'featured' ? 'mb-4' : variant === 'regular' ? 'mb-3' : 'mb-2'}`}>
      {post.data.category && (
        <span class={config.categoryClass}>
          {post.data.category}
        </span>
      )}
      {showFeaturedBadge && (
        <span class="text-orange-500 font-medium text-sm">{featuredText}</span>
      )}
    </div>
    <h3 class={config.titleClass}>
      {post.data.title}
    </h3>
    <p class={config.descClass}>
      {post.data.description}
    </p>
    <div class={`flex items-center justify-between ${variant === 'related' ? 'text-xs' : 'text-sm'} text-gray-500 dark:text-gray-400 ${variant === 'regular' || variant === 'related' ? 'mt-auto' : ''}`}>
      <FormattedDate date={post.data.pubDate} />
      {post.data.readTime && (
        <span>{post.data.readTime} min read</span>
      )}
    </div>
  </div>
</Card>

<style>
  .blog-card-image {
    transition: transform 500ms cubic-bezier(0, 0, 0.2, 1);
    will-change: transform;
  }

  .blog-card:hover .blog-card-image {
    transform: scale(1.1);
  }

  /* Ensure smooth performance */
  @media (prefers-reduced-motion: reduce) {
    .blog-card-image {
      transition: none;
    }

    .blog-card:hover .blog-card-image {
      transform: none;
    }
  }
</style>
