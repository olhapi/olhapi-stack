---
import { useTranslations } from '../utils/i18n';
import { Copy, Check, Twitter, Linkedin, Facebook } from '@lucide/astro';

interface Props {
  lang: string;
  title: string;
  url: string;
  description?: string;
}

const { lang, title, url, description = '' } = Astro.props;

const translations = {
  en: {
    shareTitle: 'Share this article',
    shareOn: 'Share on',
    twitter: 'Twitter',
    linkedin: 'LinkedIn',
    facebook: 'Facebook',
    copyLink: 'Copy link',
  },
  de: {
    shareTitle: 'Artikel teilen',
    shareOn: 'Teilen auf',
    twitter: 'Twitter',
    linkedin: 'LinkedIn',
    facebook: 'Facebook',
    copyLink: 'Link kopieren',
  },
};

const $t = useTranslations(translations, lang);

// Encode URL and text for social sharing
const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);
const encodedDescription = encodeURIComponent(description);

const shareUrls = {
  twitter: `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`,
  linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,
  facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
};
---

<div class="social-share bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700">
  <h3 class="social-share__title text-gray-900 dark:text-white">{$t('shareTitle')}</h3>

  <div class="social-share__buttons">
    <!-- Twitter -->
    <a
      href={shareUrls.twitter}
      target="_blank"
      rel="noopener noreferrer"
      class="social-share__button social-share__button--twitter"
      aria-label={`${$t('shareOn')} ${$t('twitter')}`}
    >
      <Twitter class="social-share__icon" fill="currentColor" />
      <span class="sr-only">{$t('twitter')}</span>
    </a>

    <!-- LinkedIn -->
    <a
      href={shareUrls.linkedin}
      target="_blank"
      rel="noopener noreferrer"
      class="social-share__button social-share__button--linkedin"
      aria-label={`${$t('shareOn')} ${$t('linkedin')}`}
    >
      <Linkedin class="social-share__icon" fill="currentColor" />
      <span class="sr-only">{$t('linkedin')}</span>
    </a>

    <!-- Facebook -->
    <a
      href={shareUrls.facebook}
      target="_blank"
      rel="noopener noreferrer"
      class="social-share__button social-share__button--facebook"
      aria-label={`${$t('shareOn')} ${$t('facebook')}`}
    >
      <Facebook class="social-share__icon" fill="currentColor" />
      <span class="sr-only">{$t('facebook')}</span>
    </a>

    <!-- Copy Link -->
    <button
      class="social-share__button social-share__button--copy"
      data-url={url}
      aria-label={$t('copyLink')}
    >
      <Copy class="social-share__icon social-share__icon--copy" size={20} />
      <Check class="social-share__icon social-share__icon--check" size={20} />
      <span class="sr-only">{$t('copyLink')}</span>
    </button>
  </div>
</div>

<style>
  .social-share {
    border-radius: 0.75rem;
    padding: 1.5rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  }

  .social-share__title {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
  }

  .social-share__buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .social-share__button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 3rem;
    height: 3rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    text-decoration: none;
    border: none;
    cursor: pointer;
    position: relative;
  }

  .social-share__button:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
  }

  .social-share__button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .social-share__button--twitter {
    background-color: #000000;
    color: #ffffff;
  }

  .social-share__button--twitter:hover {
    background-color: #1a1a1a;
  }

  .social-share__button--linkedin {
    background-color: #0077b5;
    color: #ffffff;
  }

  .social-share__button--linkedin:hover {
    background-color: #005885;
  }

  .social-share__button--facebook {
    background-color: #1877f2;
    color: #ffffff;
  }

  .social-share__button--facebook:hover {
    background-color: #166fe5;
  }

  .social-share__button--copy {
    background-color: #6b7280;
    color: #ffffff;
  }

  .social-share__button--copy:hover {
    background-color: #4b5563;
  }

  .social-share__icon {
    width: 1.25rem;
    height: 1.25rem;
    transition: all 0.3s ease;
    position: absolute;
  }

  .social-share__icon--copy {
    opacity: 1;
    transform: scale(1);
  }

  .social-share__icon--check {
    opacity: 0;
    transform: scale(0.8);
  }

  .social-share__button--copy.copied .social-share__icon--copy {
    opacity: 0;
    transform: scale(0.8);
  }

  .social-share__button--copy.copied .social-share__icon--check {
    opacity: 1;
    transform: scale(1);
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const copyButton = document.querySelector('.social-share__button--copy');

    if (copyButton) {
      copyButton.addEventListener('click', async () => {
        const url = copyButton.getAttribute('data-url');
        if (!url) return;

        try {
          await navigator.clipboard.writeText(url);
          showCopySuccess();
        } catch (err) {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = url;
          textArea.style.position = 'fixed';
          textArea.style.left = '-999999px';
          textArea.style.top = '-999999px';
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          showCopySuccess();
        }
      });
    }

    function showCopySuccess() {
      if (copyButton) {
        copyButton.classList.add('copied');
        setTimeout(() => {
          copyButton.classList.remove('copied');
        }, 2000);
      }
    }
  });
</script>

